# 7.4 주파수 의존 노이즈 모델 확장과 QEC 주기 최적화

## 1. 문제 인식: 단순 멱법칙 모델의 한계

7.3절에서 확인한 비단조적 크로스오버 패턴은, 기존의 단순 노이즈 모델
$$
S_\Phi(\omega) = \frac{A}{\omega^\alpha}
$$
이 IBM 하드웨어의 실제 노이즈 구조를 완전히 포착하지 못한다는 것을 보여준다.

### 1.1 기존 모델의 가정과 실험 데이터의 불일치

**기존 가정**:
- 노이즈 스펙트럼이 단일 멱법칙을 따름
- SFE는 저주파 모멘트 억제로 **항상** CPMG보다 우수

**실험 관측**:
- $T=10\,\mu\text{s}$: CPMG > SFE ($r = 0.54$)
- $T=20\,\mu\text{s}$: SFE > CPMG ($r = 1.21$)
- $T \geq 50\,\mu\text{s}$: 둘이 비슷 ($r \approx 0.95$)

이 패턴은 노이즈 스펙트럼이 **주파수에 따라 다른 구조**를 가지며, duration에 따라 **유효 주파수 범위가 변하면서** 서로 다른 노이즈 소스가 지배적으로 바뀐다는 것을 의미한다.

---

## 2. 확장 모델 1: 다중 로렌츠 피크 + 1/f 배경

### 2.1 물리적 동기

실제 초전도 큐비트 노이즈는:
1. **TLS (Two-Level System) 요동**: 특정 주파수 근처에서 피크
2. **전하 노이즈**: 저주파에서 $1/f^{1.0–1.5}$
3. **플럭스 노이즈**: 중간 주파수에서 $1/f^{0.5–1.0}$
4. **게이트 오류**: 펄스 개수에 비례, 백색 스펙트럼

이를 포괄하는 모델:
$$
S_\Phi(\omega) = \frac{A_{\text{low}}}{\omega^{\alpha_{\text{low}}}} + \sum_{j=1}^{N_{\text{TLS}}} \frac{\Gamma_j}{(\omega - \omega_j)^2 + \Gamma_j^2} + S_{\text{white}}
$$

여기서:
- $A_{\text{low}}/\omega^{\alpha_{\text{low}}}$: 저주파 배경 (전하/플럭스 노이즈)
- 로렌츠 피크: TLS 공명
- $S_{\text{white}}$: 백색 노이즈 (게이트 오류, $T_1$ 감쇠)

### 2.2 필터 함수와의 결합

디코히어런스는
$$
\chi(T) = \int_0^\infty \frac{d\omega}{2\pi} S_\Phi(\omega) |Y(\omega, T)|^2
$$

- **저주파 배경**: SFE의 저주파 모멘트 억제가 효과적
- **TLS 피크**: 특정 주파수 $\omega_j \sim 1/T$ 근처에서 CPMG의 규칙적 간격이 유리할 수 있음
- **백색**: duration $T$에 비례, 펄스 개수에도 의존

### 2.3 크로스오버 메커니즘

- **$T \sim 10\,\mu\text{s}$** ($1/T \sim 0.1\ \mu\text{s}^{-1}$):  
  만약 $\omega \sim 0.5\ \mu\text{s}^{-1}$ 근처에 TLS 피크가 있다면,  
  CPMG의 균일 간격이 이 피크를 더 잘 억제 → **CPMG 우세**

- **$T \sim 20\,\mu\text{s}$** ($1/T \sim 0.05\ \mu\text{s}^{-1}$):  
  저주파 배경이 지배적 → SFE의 저주파 모멘트 억제 효과 → **SFE 우세**

- **$T \gtrsim 50\,\mu\text{s}$**:  
  백색 노이즈가 압도 → 차이 소멸

---

## 3. 확장 모델 2: 주파수 의존 필터 이득 함수

### 3.1 정의

CPMG 대비 SFE의 상대 이득을 주파수 함수로 정의:
$$
G(\omega) \equiv \frac{|Y_{\text{CPMG}}(\omega)|^2}{|Y_{\text{SFE}}(\omega)|^2}
$$

- $G(\omega) > 1$: SFE가 해당 주파수를 더 잘 억제
- $G(\omega) < 1$: CPMG가 더 우수

### 3.2 $G(\omega)$의 예상 구조

수치 계산을 통해 (7.2절 러스트 엔진 기반):

1. **극저주파** ($\omega \ll 1/T$):  
   $$
   G(\omega) \approx 1 + C \cdot (\omega T)^2
   $$
   $C > 0$ → SFE의 2차 모멘트 억제 효과

2. **중간 주파수** ($\omega \sim 1/T$):  
   $G(\omega)$가 진동하며, 특정 $\omega = \omega_{\text{cross}}$에서 $G < 1$일 수 있음  
   → 이 영역에서 CPMG 우세

3. **고주파** ($\omega \gg 1/T$):  
   $G(\omega) \to 1$ (둘 다 억제 못 함)

### 3.3 유효 이득 비

전체 디코히어런스 비는
$$
r = \frac{\chi_{\text{CPMG}}}{\chi_{\text{SFE}}} = \frac{\int d\omega\, S_\Phi(\omega) |Y_{\text{CPMG}}|^2}{\int d\omega\, S_\Phi(\omega) |Y_{\text{SFE}}|^2}
= \frac{\int d\omega\, S_\Phi(\omega) G(\omega) |Y_{\text{SFE}}|^2}{\int d\omega\, S_\Phi(\omega) |Y_{\text{SFE}}|^2}
$$

즉, **$S_\Phi(\omega)$와 $G(\omega)$의 곱의 가중 평균**으로 결정된다.

- $S_\Phi(\omega)$가 저주파 집중 → $G > 1$ 영역 지배 → $r > 1$ (SFE 우세)
- $S_\Phi(\omega)$가 중간 주파수 집중 → $G < 1$ 영역 지배 → $r < 1$ (CPMG 우세)

**Duration $T$가 바뀌면 $1/T$도 바뀌므로, 유효 주파수 범위가 이동하며 $r$이 비단조적으로 변한다.**

---

## 4. 역문제: 실험 데이터로부터 $S_\Phi(\omega)$ 재구성

### 4.1 이산 주파수 근사

$N$개 duration $T_1, \dots, T_N$에서 측정한 $\chi_i^{\text{obs}}$ (CPMG, SFE 각각)에 대해,  
노이즈 스펙트럼을 $M$개 주파수 빈 $\{\omega_k\}$에서의 값 $\{S_k\}$로 근사:
$$
\chi_i \approx \sum_{k=1}^M W_{ik} S_k
$$

여기서 가중치는
$$
W_{ik}^{\text{CPMG/SFE}} = \int_{\omega_{k-1/2}}^{\omega_{k+1/2}} \frac{d\omega}{2\pi} |Y_{\text{CPMG/SFE}}(\omega, T_i)|^2
$$

### 4.2 정칙화된 역산

행렬 형태로
$$
\boldsymbol{\chi}^{\text{obs}} = \mathbf{W} \mathbf{S}
$$

$\mathbf{W}$는 알려져 있고 (필터 함수 계산으로), $\mathbf{S}$를 구하는 것이 목표.

부정적합 문제이므로 Tikhonov 정칙화:
$$
\mathbf{S}^* = \arg\min_{\mathbf{S} \geq 0} \left[ \|\mathbf{W} \mathbf{S} - \boldsymbol{\chi}^{\text{obs}}\|^2 + \lambda \|\mathbf{L} \mathbf{S}\|^2 \right]
$$

여기서 $\mathbf{L}$은 smoothness penalty (e.g., 2차 차분).

### 4.3 필요 조건

- **충분한 duration 포인트**: 최소 $N > M$ (현재 10개)
- **CPMG + SFE 동시 피팅**: 두 시퀀스의 필터 함수 차이가 $\mathbf{W}$ rank를 높임
- **다양한 펄스 개수**: $N_p = 4, 8, 16$ 등으로 필터 구조 다양화

---

## 5. QEC 주기 최적화 전략

### 5.1 QEC 사이클 시간과 필터 함수의 관계

Surface code에서 QEC 사이클 1회는:
1. 신드롬 측정 (시간 $T_{\text{syn}}$)
2. 데이터 큐비트 대기 (시간 $T_{\text{idle}}$)

SFE/CPMG 펄스는 $T_{\text{idle}}$ 구간에 적용된다.

논리 오류율은
$$
P_L \propto \left[ p_{\text{phy}}(T_{\text{idle}}) \right]^{(d+1)/2}
$$

여기서 $p_{\text{phy}}(T)$는 duration $T$에서의 물리 오류율이다.

### 5.2 최적 주기 찾기

실험 데이터에서 SFE/CPMG 비 $r(T)$를 보면:
- $T=10\,\mu\text{s}$: $r=0.54$ → SFE 불리
- $T=20\,\mu\text{s}$: $r=1.21$ → **SFE 최적**
- $T=50\,\mu\text{s}$: $r=0.99$ → 차이 없음

따라서 **$T_{\text{idle}} \approx 20\,\mu\text{s}$가 SFE 스윗 스팟**이다.

만약 QEC 사이클이 $T_{\text{syn}} + T_{\text{idle}} = 10 + 20 = 30\,\mu\text{s}$라면,  
distance $d=5$에서
$$
\frac{P_L^{\text{CPMG}}}{P_L^{\text{SFE}}} \approx 1.21^3 \approx 1.77
$$
즉, **SFE가 논리 오류율을 1.77배 감소**시킨다.

### 5.3 동적 주기 조정

노이즈가 시간에 따라 변한다면 (드리프트), 주기적으로 짧은 calibration sweep을 수행하여 $r(T)$를 재측정하고, $T_{\text{idle}}$을 **런타임에 조정**할 수 있다.

---

## 6. 러스트 엔진 확장 계획

### 6.1 주파수 의존 노이즈 생성기

기존 `PinkNoiseGenerator`를 확장하여, 다중 로렌츠 피크를 포함하는 스펙트럼 생성:

```rust
pub struct MultiPeakNoiseGenerator {
    pink_alpha: f64,
    pink_scale: f64,
    lorentzian_peaks: Vec<LorentzianPeak>,
    white_level: f64,
}

struct LorentzianPeak {
    omega_center: f64, // rad/us
    gamma: f64,        // linewidth
    amplitude: f64,
}

impl MultiPeakNoiseGenerator {
    pub fn spectrum(&self, omega: f64) -> f64 {
        let pink = self.pink_scale / omega.powf(self.pink_alpha);
        let lorentz: f64 = self.lorentzian_peaks.iter()
            .map(|p| p.amplitude * p.gamma / ((omega - p.omega_center).powi(2) + p.gamma.powi(2)))
            .sum();
        pink + lorentz + self.white_level
    }
}
```

### 6.2 주파수 이득 함수 $G(\omega)$ 계산

필터 함수의 비를 주파수 도메인에서 직접 계산:

```rust
pub fn compute_gain_function(
    pulses_cpmg: &[f64],
    pulses_sfe: &[f64],
    duration: f64,
    omega_grid: &[f64],
) -> Vec<f64> {
    omega_grid.iter().map(|&omega| {
        let y_cpmg = filter_function_val(pulses_cpmg, duration, omega);
        let y_sfe = filter_function_val(pulses_sfe, duration, omega);
        (y_cpmg / y_sfe).powi(2)
    }).collect()
}
```

### 6.3 스펙트럼 역산 솔버

Tikhonov 정칙화 기반:

```rust
use nalgebra::{DMatrix, DVector};

pub fn reconstruct_spectrum(
    durations: &[f64],
    chi_obs_cpmg: &[f64],
    chi_obs_sfe: &[f64],
    omega_bins: &[f64],
    lambda: f64,
) -> Vec<f64> {
    // W 행렬 구성 (필터 함수 적분)
    let W = build_weight_matrix(durations, omega_bins);
    
    // Tikhonov 정칙화
    let L = smoothness_penalty_matrix(omega_bins.len());
    let WtW = W.transpose() * &W;
    let LtL = L.transpose() * L;
    
    let A = WtW + lambda * LtL;
    let b = W.transpose() * DVector::from_vec(chi_obs_cpmg.to_vec());
    
    A.lu().solve(&b).unwrap().as_slice().to_vec()
}
```

---

## 7. 실험 제안: 멀티 펄스 개수 스윕

### 7.1 실험 파라미터

- **펄스 개수**: $N_p = 4, 8, 16, 32$
- **Duration**: $T = 10, 20, 30, 50\,\mu\text{s}$ (4개, 고정)
- **시퀀스**: 각 $N_p$에 대해 CPMG vs SFE 최적 시퀀스
- **총 회로 수**: $4 \times 4 \times 2 = 32$ circuits

### 7.2 예상 결과

- **낮은 $N_p$** (4펄스):  
  필터 함수가 저주파 억제 약함 → SFE 이점 작음

- **중간 $N_p$** (8–16펄스):  
  SFE의 저주파 모멘트 억제 본격 발휘 → $r > 1$ 구간 확대

- **높은 $N_p$** (32펄스):  
  게이트 오류 누적으로 백색 노이즈 지배 → $r \to 1$

이를 통해 **펄스 개수와 duration의 2차원 최적화 지도**를 얻을 수 있다.

---

## 8. 이론적 예측: SFE 스윗 스팟의 보편성

### 8.1 무차원 변수 도입

노이즈 스펙트럼의 특성 주파수를 $\omega_c$라 할 때,
$$
\tilde{\omega} = \omega / \omega_c, \quad \tilde{T} = \omega_c T
$$

디코히어런스 비는 무차원 duration $\tilde{T}$의 함수:
$$
r(\tilde{T}) = \frac{\int d\tilde{\omega}\, \tilde{S}(\tilde{\omega}) |\tilde{Y}_{\text{CPMG}}(\tilde{\omega}, \tilde{T})|^2}{\int d\tilde{\omega}\, \tilde{S}(\tilde{\omega}) |\tilde{Y}_{\text{SFE}}(\tilde{\omega}, \tilde{T})|^2}
$$

### 8.2 보편 곡선 가설

만약 노이즈 스펙트럼이 같은 **스케일링 형태**를 가진다면,  
$r(\tilde{T})$는 장치에 무관하게 **보편 곡선**을 따를 것이다.

IBM Fez 데이터에서:
- $\omega_c \sim 0.2\ \mu\text{s}^{-1}$ (추정)
- $T=20\,\mu\text{s}$ → $\tilde{T} \sim 4$에서 $r$ 최대

다른 장치에서도 $\tilde{T} \sim 4$ 근처에서 SFE 스윗 스팟이 나타날 것으로 예상된다.

---

## 9. 결론 및 향후 계획

### 9.1 본 절의 기여

- 단순 $1/f$ 모델의 한계를 넘어, **다중 로렌츠 피크 + 배경** 모델 제시
- 주파수 이득 함수 $G(\omega)$ 도입으로 크로스오버 메커니즘 정식화
- 실험 데이터로부터 $S_\Phi(\omega)$ 재구성하는 역문제 정립
- QEC 주기 최적화 전략: **스윗 스팟 duration 선택**

### 9.2 즉시 실행 가능한 작업

1. **러스트 엔진 확장**:
   - `MultiPeakNoiseGenerator` 구현
   - 주파수 이득 함수 $G(\omega)$ 시각화 스크립트

2. **IBM Quantum 추가 실험**:
   - 멀티 펄스 개수 스윕 (4, 8, 16, 32 펄스)
   - 다중 백엔드 검증 (Fez 외 다른 장치)

3. **스펙트럼 역산 파이프라인**:
   - `examples/backend/reconstruct_spectrum.py` 작성
   - Tikhonov 정칙화 파라미터 $\lambda$ 최적화

### 9.3 장기 목표

- **SFE 스윗 스팟 자동 탐색 알고리즘**: 런타임 calibration 포함
- **QEC 통합**: Surface code 시뮬레이터에 실제 $S_\Phi(\omega)$ 주입
- **이론 논문 출판**: "Frequency-Dependent Filter Function Analysis of Dynamical Decoupling in Superconducting Qubits"

본 절은 SFE 이론을 **실험 데이터 기반의 정량적 도구**로 진화시키는 토대를 마련했다.

